<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToDo List</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <main>
        <div class="top">
            <h1 class="title">To-Do list Səhifəsi</h1>
            <div class="add">
                <input type="text" placeholder="To Do yaz" id="addToDoInput">
                <button id="addToDoButton">Todo əlavə et</button>
            </div>
            <div class="search">
                <h2>To Do Listi</h2>
                <input type="text" id="searchInput" placeholder="To Do axtar">
                <hr>
                <div class="foundToDos"></div>
                <button class="clearAll">Bütün Todoları sil</button>
            </div>
        </div>
    </main>
    <script>
        const addToDoButton = document.querySelector("#addToDoButton");
        const addingPlace = document.querySelector(".foundToDos");
        const addToDoInput = document.querySelector("#addToDoInput");
        const clearAllToDo = document.querySelector(".clearAll");
        const searchToDo = document.querySelector("#searchInput");
        let toDos = [];

        // Load existing todos from local storage
        loadAll();

        addToDoButton.addEventListener('click', function func1() {
            const todoText = addToDoInput.value.trim();
            if (todoText === "") {
                alert("Please add a name");
            } else {
                createToDo(todoText);
            }
        });

        clearAllToDo.addEventListener('click', function clearAll() {
            addingPlace.innerHTML = "";
            toDos = [];
            replaceStorage();
        });

        searchToDo.addEventListener('keyup', search);

        function loadAll() {
            toDos = JSON.parse(localStorage.getItem("todos")) || [];
            console.log(toDos);

            // Clear the existing todos in the DOM
            addingPlace.innerHTML = "";

            // Create todo elements in the DOM
            toDos.forEach(function (todo) {
                createTodoInDOM(todo.text); // Use the "text" property
            });
        }


        function createToDo(text) {
            const newElementP = document.createElement("p");
            const newElement = document.createElement("div");
            const newElementI = document.createElement("i");

            newElementI.className = "fa fa-close";

            const newElementB = document.createElement("button");
            newElement.appendChild(newElementP);
            newElementB.appendChild(newElementI);
            newElement.appendChild(newElementB);
            newElementP.textContent = text;

            addingPlace.appendChild(newElement);
            addToDoInput.value = "";

            newElementB.addEventListener('click', function () {
                newElement.remove();
                toDos = toDos.filter(function (todo) {
                    return todo.text !== text;
                });
                replaceStorage();
            });

            toDos.push({ text }); // Store as an object with a "text" property
            addStorage();
        }

        function search() {
            const value = searchToDo.value.trim().toUpperCase();
            addingPlace.innerHTML = "";

            toDos.forEach(function (todo) {
                if (todo.text.trim().toUpperCase().includes(value)) {
                    createTodoInDOM(todo.text); // Create todo elements based on the filtered list
                }
            });

            if (addingPlace.children.length === 0) {
                addingPlace.innerHTML = "To Do tapılmadı.";
            }
        }

        function addStorage() {
            localStorage.setItem("todos", JSON.stringify(toDos));
        }

        function replaceStorage() {
            localStorage.removeItem("todos");
            localStorage.setItem("todos", JSON.stringify(toDos));
        }

        // Function to create todo elements in the DOM
        function createTodoInDOM(text) {
            const newElementP = document.createElement("p");
            const newElement = document.createElement("div");
            const newElementI = document.createElement("i");

            newElementI.className = "fa fa-close";

            const newElementB = document.createElement("button");
            newElement.appendChild(newElementP);
            newElementB.appendChild(newElementI);
            newElement.appendChild(newElementB);
            newElementP.textContent = text;

            addingPlace.appendChild(newElement);

            newElementB.addEventListener('click', function () {
                newElement.remove();
                toDos = toDos.filter(function (item) {
                    return item.text !== text;
                });
                replaceStorage();
            });
        }
    </script>
</body>

</html>